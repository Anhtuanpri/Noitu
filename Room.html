<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>PhÃ²ng Ná»‘i Chá»¯</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase SDK v12 -->
<script type="module">
import { initializeApp } from
  "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded }
  from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDiv0nqf1Gse7sDxwVVon-LtL_kbkLYS3A",
  authDomain: "noitu-560ef.firebaseapp.com",
  databaseURL: "https://noitu-560ef-default-rtdb.firebaseio.com",
  projectId: "noitu-560ef"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ===== Láº¤Y TÃŠN + PHÃ’NG =====
const params = new URLSearchParams(location.search);
const roomId = params.get("room");
const user = localStorage.getItem("username") || "áº¨n danh";

// ===== REF =====
const chatRef = ref(db, `rooms/${roomId}/chat`);

// ===== UI =====
const chatBox = document.getElementById("chat");
const input = document.getElementById("input");
document.getElementById("roomLink").innerText =
  location.origin + location.pathname + "?room=" + roomId;

// ===== HIá»‚N THá»Š CHAT REALTIME =====
onChildAdded(chatRef, snap => {
  const d = snap.val();
  const div = document.createElement("div");
  div.className = "msg " + (d.user === "HOST" ? "host" : "user");
  div.innerHTML = `<b>${d.user}</b><br>${d.text}`;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
});

// ===== Gá»¬I =====
window.send = function(){
  const text = input.value.trim();
  if(!text) return;
  input.value = "";

  push(chatRef, { user, text });
};
</script>
</head>

<body>

<div class="room">

  <div class="top">
    <div>
      ðŸ‘¤ <b id="me"></b><br>
      ðŸ”— <small id="roomLink"></small>
    </div>
  </div>

  <div id="chat" class="chat"></div>

  <div class="input-row">
    <input id="input" placeholder="Chat hoáº·c nháº­p tá»« ná»‘iâ€¦">
    <button onclick="send()">Gá»­i</button>
  </div>

</div>

<script>
document.getElementById("me").innerText =
  localStorage.getItem("username") || "áº¨n danh";
</script>

</body>
</html>
