<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>N·ªëi T·ª´ Gh√©p - Login</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{
  margin:0;font-family:system-ui;
  background:radial-gradient(circle,#1e0b4b,#020617);
  color:#e5e7eb;
}
.center{display:flex;align-items:center;justify-content:center;height:100vh}
.box{
  width:360px;padding:28px;border-radius:20px;
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(16px);
  box-shadow:0 0 40px rgba(168,85,247,.5);
}
input,button{
  width:100%;margin:8px 0;padding:14px;
  border:none;border-radius:14px;font-weight:700;
}
button{
  cursor:pointer;
  background:linear-gradient(135deg,#7c3aed,#22d3ee);
}
</style>
</head>
<body>

<div class="center">
  <div class="box">
    <h2>üîÆ N·ªêI T·ª™ GH√âP</h2>
    <input id="nameInput" placeholder="T√™n c·ªßa b·∫°n">
    <input id="hostInput" placeholder="M√£ host (n·∫øu c√≥)">
    <button onclick="enter()">V√ÄO PH√íNG</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const HOST_CODE="1.2991.22283.33";
const params=new URLSearchParams(location.search);
const room=params.get("room")||"phong-chung";

const app=initializeApp({
  apiKey:"AIzaSyBdKC3vCBjHhsakrE1hUYg-2_Vi9JYX3vk",
  databaseURL:"https://noitu-7dca6-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"noitu-7dca6"
});
const db=getDatabase(app);

nameInput.value = localStorage.getItem("noitu_name") || "";

window.enter = async ()=>{
  if(!nameInput.value) return;
  localStorage.setItem("noitu_name",nameInput.value);

  const stateRef = ref(db,`rooms/${room}/state`);
  const snap = await get(stateRef);

  if(!snap.exists() && hostInput.value.trim()===HOST_CODE){
    await set(stateRef,{
      host: nameInput.value,
      status:"waiting",
      mode:null,
      root:null,
      gptKey:null
    });
    location.href=`mode.html?room=${room}`;
  }else{
    location.href=`game.html?room=${room}`;
  }
};
</script>
</body>
</html>
