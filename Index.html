<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Run 3 – Mobile Stable</title>

<meta name="viewport"
      content="width=device-width,height=device-height,initial-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">

<link rel="shortcut icon"
      href="https://cdn.jsdelivr.net/gh/VinMannie/Run_3@gh-pages/favicon.png">

<script src="https://cdn.jsdelivr.net/gh/cooldude2349/bugfixes@main/Run3beta.js"></script>

<style>
html,body{
    margin:0;
    padding:0;
    height:100%;
    overflow:hidden;
    background:#000;
    touch-action:none;
}
#openfl-content{
    width:100%;
    height:100%;
}
</style>
</head>

<body>
<div id="openfl-content"></div>

<script>
lime.embed("Run3", "openfl-content", 800, 600, {});

/* ===== KEY SENDER ===== */
function key(type, code, kc){
    document.dispatchEvent(new KeyboardEvent(type,{
        code: code,
        key: code==="Space" ? " " : code,
        keyCode: kc,
        which: kc,
        bubbles:true
    }));
}

/* ===== JUMP (1 FINGER ONLY) ===== */
let jumping = false;
let jumpLoop = null;

document.addEventListener("touchstart", e=>{
    if(e.touches.length !== 1) return; // chỉ 1 ngón mới nhảy
    e.preventDefault();

    jumping = true;
    key("keydown","Space",32);
    jumpLoop = setInterval(()=>{
        key("keydown","Space",32);
    },30);
},{passive:false});

document.addEventListener("touchend", e=>{
    if(jumping){
        clearInterval(jumpLoop);
        jumpLoop = null;
        key("keyup","Space",32);
        jumping = false;
    }
},{passive:false});

/* ===== ROTATE (2 FINGERS ONLY) ===== */
let twoFingerStartX = null;

document.addEventListener("touchstart", e=>{
    if(e.touches.length === 2){
        twoFingerStartX =
            (e.touches[0].clientX + e.touches[1].clientX) / 2;
    }
},{passive:false});

document.addEventListener("touchend", e=>{
    if(twoFingerStartX === null || jumping) return;

    let dx =
      ((e.changedTouches[0]?.clientX || 0) - twoFingerStartX);

    if(Math.abs(dx) > 60){
        if(dx > 0){
            key("keydown","ArrowRight",39);
            setTimeout(()=>key("keyup","ArrowRight",39),60);
        }else{
            key("keydown","ArrowLeft",37);
            setTimeout(()=>key("keyup","ArrowLeft",37),60);
        }
    }
    twoFingerStartX = null;
},{passive:false});

document.body.addEventListener("touchmove",
    e=>e.preventDefault(),{passive:false});
</script>

</body>
</html>
