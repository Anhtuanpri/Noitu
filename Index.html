<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>N·ªëi T·ª´ Gh√©p</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui;
  background:linear-gradient(135deg,#020617,#0f172a);
  color:#e5e7eb;
}
.center{
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  width:340px;
  padding:24px;
  border-radius:18px;
  background:rgba(255,255,255,.06);
  backdrop-filter:blur(14px);
  box-shadow:0 0 30px rgba(139,92,246,.4);
  text-align:center;
}
.room{
  max-width:520px;
  margin:0 auto;
  height:100vh;
  display:flex;
  flex-direction:column;
}
.header{
  padding:12px;
  border-bottom:1px solid #334155;
  display:flex;
  justify-content:space-between;
  align-items:center;
  color:#c4b5fd;
}
.chat{
  flex:1;
  overflow:auto;
  padding:12px;
}
.msg{
  margin:6px 0;
  padding:10px 14px;
  border-radius:14px;
  max-width:85%;
}
.system{
  background:#1e293b;
  color:#93c5fd;
}
.correct{
  background:#052e16;
  color:#4ade80;
}
.wrong{
  background:#450a0a;
  color:#f87171;
}
.input-row{
  display:flex;
  gap:8px;
  padding:10px;
  border-top:1px solid #334155;
}
input{
  flex:1;
  padding:12px;
  border:none;
  border-radius:10px;
}
button{
  padding:12px 16px;
  border:none;
  border-radius:10px;
  background:#7c3aed;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
.hidden{display:none}

/* toast */
#toast{
  position:fixed;
  top:20px;
  right:20px;
  padding:10px 14px;
  border-radius:12px;
  font-weight:700;
  opacity:0;
  transition:.25s;
}
#toast.show{opacity:1}
.toast-ok{background:#052e16;color:#4ade80}
.toast-bad{
  background:#450a0a;color:#f87171;
  animation:shake .2s linear 3
}
@keyframes shake{
  0%{transform:translateX(0)}
  50%{transform:translateX(4px)}
  100%{transform:translateX(-4px)}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="center">
  <div class="card">
    <h2>üîó N·ªëi T·ª´ Gh√©p</h2>
    <input id="nameInput" placeholder="T√™n c·ªßa b·∫°n">
    <button onclick="enter()">V√†o ch∆°i</button>
    <p style="font-size:13px;color:#aaa">Sai 1 l·∫ßn = lo·∫°i</p>
  </div>
</div>

<!-- ROOM -->
<div id="room" class="room hidden">
  <div class="header">
    <span>ü§ñ Tr·ªçng t√†i</span>
    <span id="rootWord"></span>
  </div>
  <div id="chat" class="chat"></div>
  <div class="input-row">
    <input id="text" placeholder="Nh·∫≠p t·ª´ gh√©p‚Ä¶">
    <button onclick="send()">G·ª≠i</button>
  </div>
</div>

<div id="toast"></div>

<script type="module">
import { initializeApp } from
  "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getDatabase, ref, push, onChildAdded, set, get
} from
  "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

/* üî• FIREBASE ‚Äì S·ª¨A CHO ƒê√öNG PROJECT */
const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT-default-rtdb.firebaseio.com",
  projectId: "PROJECT",
  appId: "APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* GAME STATE */
const roomId = "room";
const chatRef = ref(db, roomId + "/chat");
const stateRef = ref(db, roomId + "/state");

let name = "";
let eliminated = false;

/* UI */
const chat = document.getElementById("chat");
const toast = document.getElementById("toast");
const rootEl = document.getElementById("rootWord");

function notify(msg, ok=true){
  toast.className="";
  toast.textContent=msg;
  toast.classList.add("show", ok?"toast-ok":"toast-bad");
  setTimeout(()=>toast.classList.remove("show"),1000);
}
function add(text, cls){
  const d=document.createElement("div");
  d.className="msg "+cls;
  d.textContent=text;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

/* ENTER */
window.enter = async ()=>{
  name = nameInput.value.trim();
  if(!name) return;
  login.classList.add("hidden");
  room.classList.remove("hidden");

  const snap = await get(stateRef);
  if(!snap.exists()){
    const roots=["t·ªï","con","ma","qu·ªëc","h·ªìn"];
    const root = roots[Math.floor(Math.random()*roots.length)];
    await set(stateRef,{ root });
    add("ü§ñ B·∫Øt ƒë·∫ßu v·ªõi: "+root,"system");
    rootEl.textContent="G·ªëc: "+root;
  }else{
    rootEl.textContent="G·ªëc: "+snap.val().root;
  }
};

/* REALTIME LISTEN */
onChildAdded(chatRef, s=>{
  const d=s.val();
  add(d.text, d.cls);
});

/* CORE CHECK (MOCK ‚Äì CH·∫ÆC CH·∫ÆN CH·∫†Y) */
function checkWord(root, answer){
  const parts = answer.trim().toLowerCase().split(/\s+/);
  if(parts.length < 2) return null;
  if(parts[0] !== root) return null;
  return parts[parts.length-1]; // t·ª´ g·ªëc m·ªõi
}

/* SEND */
window.send = async ()=>{
  if(eliminated){
    notify("B·∫°n ƒë√£ b·ªã lo·∫°i", false);
    return;
  }

  const val = text.value.trim().toLowerCase();
  if(!val) return;
  text.value="";

  const st = (await get(stateRef)).val();
  const next = checkWord(st.root, val);

  if(!next){
    eliminated = true;
    push(chatRef,{
      text:`‚ùå ${name} sai v√† b·ªã lo·∫°i`,
      cls:"wrong"
    });
    notify("Sai ‚Äì b·∫°n b·ªã lo·∫°i", false);
    return;
  }

  await set(stateRef,{ root: next });
  push(chatRef,{
    text:`‚úÖ ${name}: ${val}`,
    cls:"correct"
  });
  rootEl.textContent="G·ªëc: "+next;
  notify("ƒê√∫ng!", true);
};
</script>

</body>
</html>
