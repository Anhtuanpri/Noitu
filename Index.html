<!DOCTYPE html>
<html lang="en">
<head>
<base href="https://cdn.jsdelivr.net/gh/VinMannie/Run_3@gh-pages/">
<meta charset="utf-8">
<title>Run 3 Mobile – Hold Rotate</title>

<meta name="viewport"
      content="width=device-width,height=device-height,initial-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">

<link rel="shortcut icon" href="./favicon.png">
<script src="https://cdn.jsdelivr.net/gh/cooldude2349/bugfixes@main/Run3beta.js"></script>

<style>
html,body{
    margin:0;padding:0;height:100%;
    overflow:hidden;background:#000;
    touch-action:none;
}
#openfl-content{ width:100%;height:100%; }

/* ===== Controls ===== */
.control{
    position:fixed;
    bottom:20px;
    width:80px;height:80px;
    border-radius:50%;
    background:rgba(255,255,255,0.22);
    border:2px solid rgba(255,255,255,0.6);
    color:white;
    font-size:34px;
    display:flex;
    align-items:center;
    justify-content:center;
    user-select:none;
}
#leftBtn{ left:20px; }
#rightBtn{ right:20px; }
</style>
</head>

<body>
<div id="openfl-content"></div>

<div id="leftBtn" class="control">⟲</div>
<div id="rightBtn" class="control">⟳</div>

<script>
lime.embed("Run3","openfl-content",800,600,{});

/* ===== KEY SENDER ===== */
function key(type, code, kc){
    document.dispatchEvent(new KeyboardEvent(type,{
        code:code,
        key:code==="Space"?" ":code,
        keyCode:kc,
        which:kc,
        bubbles:true
    }));
}

/* ===== JUMP (HOLD) ===== */
let jumping=false;
document.addEventListener("touchstart",e=>{
    if(e.target.classList.contains("control")) return;
    jumping=true;
    key("keydown","Space",32);
},{passive:false});

document.addEventListener("touchend",e=>{
    if(jumping){
        key("keyup","Space",32);
        jumping=false;
    }
},{passive:false});

/* ===== HOLD ROTATE (FAST) ===== */
let rotateTimer=null;
const ROTATE_SPEED = 35; // càng nhỏ càng nhanh (ms)

function startRotate(dir){
    if(rotateTimer) return;
    rotateTimer = setInterval(()=>{
        if(dir==="left"){
            key("keydown","ArrowLeft",37);
            key("keyup","ArrowLeft",37);
        }else{
            key("keydown","ArrowRight",39);
            key("keyup","ArrowRight",39);
        }
    }, ROTATE_SPEED);
}
function stopRotate(){
    clearInterval(rotateTimer);
    rotateTimer=null;
}

leftBtn.addEventListener("touchstart",e=>{
    e.preventDefault();
    startRotate("left");
},{passive:false});

rightBtn.addEventListener("touchstart",e=>{
    e.preventDefault();
    startRotate("right");
},{passive:false});

leftBtn.addEventListener("touchend",stopRotate);
rightBtn.addEventListener("touchend",stopRotate);

/* block scroll */
document.body.addEventListener("touchmove",
    e=>e.preventDefault(),{passive:false});
</script>

</body>
</html>
